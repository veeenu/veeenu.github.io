<!doctype html><html><head><meta charset=utf-8><meta content="width=device-width" name=viewport><meta content="Thema Regium, math rock and procedurally generated sound" property=og:title><meta content=website property=og:type><meta content="Andrea Venuta" property=og:site_name><meta content="No big secret, I&amp#x27;m a huge fan of procedural content generation. I&amp#x27;m also a big
fan of Johann Sebastian Bach and his Musikalisches Opfer, whose fascinating
story I came to know thanks to D.R. Hofstader&amp#x27;s
&ampquot;Gödel, Escher, Bach: an Eternal Golden Braid&ampquot;." property=og:description><title>Thema Regium, math rock and procedurally generated sound</title><link href=https://veeenu.github.io/style.css rel=stylesheet><link href=https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css rel=stylesheet><link integrity="sha512-vJqxkZ+Sugf/6WRlpcxN01qVfX/29hF6qc33eHF1va3NgoV+U+wCi+uTAsQ10sDoGyBxHLdaHvGwDlV3yVYboA==" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.1/katex.min.css referrerpolicy=no-referrer rel=stylesheet><script integrity="sha512-5ufNcHqOYgilGEHPfuRIQ5B/vDS1M8+UC+DESZ5CwVgGTg+b2Ol/15rYL/GiCWJ/Sx8oVo0FPFok1dPk8U9INQ==" crossorigin defer referrerpolicy=no-referrer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.1/katex.min.js></script><script integrity="sha512-MBhOGY4yRA2eATtRGTcrDJCRqcnLai5+uu47GA2ueVr1MPzirC/iogLWRA8CXTlOTK09VI4fdTe4qE4LBfjsHw==" crossorigin defer referrerpolicy=no-referrer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.1/contrib/mathtex-script-type.min.js></script><script integrity="sha512-ZA/RPrAo88DlwRnnoNVqKINnQNcWERzRK03PDaA4GIJiVZvGFIWQbdWCsUebMZfkWohnfngsDjXzU6PokO4jGw==" crossorigin defer referrerpolicy=no-referrer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.15.1/contrib/auto-render.min.js></script><script>document.addEventListener(`DOMContentLoaded`,(()=>{let a=`\$\$`,b=`\$`;renderMathInElement(document.body,{delimiters:[{left:a,right:a,display:!0},{left:b,right:b,display:!1},{left:`\\\\(`,right:`\\\\)`,display:!1},{left:`\\\\[`,right:`\\\\]`,display:!0}],throwOnError:!1})}))</script><body><header id=menu-header><a class=image href=https://veeenu.github.io> <div><img alt="Andrea Venuta" src=https://veeenu.github.io/me.jpg></div> <span>Andrea Venuta</span> </a><ul><li><a href=https://veeenu.github.io>About</a><li><a href=https://veeenu.github.io/blog.html>Blog</a></ul></header><div class="container top-container"><article class="article twelve columns"><header><h1>Thema Regium, math rock and procedurally generated sound</h1><small> <p><time>Thursday, 4 Dec 2014</time> · <em> Reading time: 3 mins </em></p> </small></header><section><p>No big secret, I'm a huge fan of procedural content generation. I'm also a big fan of Johann Sebastian Bach and his <em>Musikalisches Opfer</em>, whose fascinating story I came to know thanks to D.R. Hofstader's <a href=http://en.wikipedia.org/wiki/G%C3%B6del,_Escher,_Bach>"Gödel, Escher, Bach: an Eternal Golden Braid"</a>.</p><span id=continue-reading></span><p>On the side of it, the readers of this blog might also know I'm a huge fan of Javascript, so at this point I don't see why putting the three things together should be a bad idea.<p>These days I've been thinking of writing an engine that generates music from a known set of rules, the same, a bit mechanical maybe, way I did while studying musical composition: begin with a bass line melody starting from the fundamental tone, move around and about in some way, one cadence after the other, finish with the V-I cadence, then backtrack and harmonize the bass line (to err on the side of simple: in the form of a choral). I know many put their compressed scores inside their demos and generate the sound according to the score, but I still haven't found pure randomly generated music (I didn't look very hard, admittedly).<p>Now for a philosophical quandary. You (I) could argue that human experience and feelings are of fundamental importance in musical composition. From this assertion alone could follow that letting a machine generate music may only result in dull, soulless, mechanical sounds.<p>On the other hand, I firmly believe math to be a means of expressing nature in a way transcending the human experience (and, oftentimes, knowledge) itself, and there's no shortage of examples - fractals, for instance, are "nothing but" beautiful mathematical representations of beautiful natural phenomena. So I'm going to try it and we'll see what comes out.<p>Anyway I began prototyping a few things, got to work and, after a few minutes of tinkering, the following came out:<pre class=language-javascript data-lang=javascript style=color:#6c7079;background-color:#2b303b><code class=language-javascript data-lang=javascript><span style=color:#cd74e8>var </span><span style=color:#eb6772>ac  </span><span style=color:#adb7c9>= new </span><span style=color:#abb2bf>window.AudioContext(),
</span><span style=color:#abb2bf>    </span><span style=color:#eb6772>osc </span><span style=color:#adb7c9>= </span><span style=color:#eb6772>ac</span><span style=color:#abb2bf>.</span><span style=color:#5cb3fa>createOscillator</span><span style=color:#abb2bf>(),
</span><span style=color:#abb2bf>    </span><span style=color:#eb6772>notes </span><span style=color:#adb7c9>= </span><span style=color:#abb2bf>{
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'c'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>261.6</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'c#'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>277.2</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'db'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>277.2</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'d'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>293.7</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'d#'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>311.1</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'eb'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>311.1</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'e'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>329.6</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'f'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>349.2</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'f#'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>370.0</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'gb'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>370.0</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'g'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>392.0</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'g#'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>415.3</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'ab'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>415.3</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'a'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>440.0</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'a#'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>466.2</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'bb'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>466.2</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'b'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>493.9</span><span style=color:#abb2bf>,
</span><span style=color:#abb2bf>      </span><span style=color:#9acc76>'--'</span><span style=color:#abb2bf>: </span><span style=color:#db9d63>1
</span><span style=color:#abb2bf>    },
</span><span style=color:#abb2bf>    </span><span style=color:#5cb3fa>toPrint </span><span style=color:#adb7c9>= </span><span style=color:#cd74e8>function</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>note</span><span style=color:#abb2bf>) {
</span><span style=color:#abb2bf>      </span><span style=color:#cd74e8>var </span><span style=color:#eb6772>out </span><span style=color:#adb7c9>= </span><span style=color:#eb6772>note</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>charAt</span><span style=color:#abb2bf>(</span><span style=color:#db9d63>0</span><span style=color:#abb2bf>).</span><span style=color:#5ebfcc>toUpperCase</span><span style=color:#abb2bf>();
</span><span style=color:#abb2bf>      </span><span style=color:#cd74e8>if</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>out </span><span style=color:#adb7c9>=== </span><span style=color:#9acc76>'-'</span><span style=color:#abb2bf>) </span><span style=color:#cd74e8>return </span><span style=color:#9acc76>''</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>      </span><span style=color:#cd74e8>if</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>note</span><span style=color:#abb2bf>.length </span><span style=color:#adb7c9>> </span><span style=color:#db9d63>1</span><span style=color:#abb2bf>) {
</span><span style=color:#abb2bf>        </span><span style=color:#cd74e8>if</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>note</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>charAt</span><span style=color:#abb2bf>(</span><span style=color:#db9d63>1</span><span style=color:#abb2bf>) </span><span style=color:#adb7c9>=== </span><span style=color:#9acc76>'b'</span><span style=color:#abb2bf>)
</span><span style=color:#abb2bf>          </span><span style=color:#eb6772>out </span><span style=color:#adb7c9>+= </span><span style=color:#9acc76>'&amp#9837;'</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>        </span><span style=color:#cd74e8>else
</span><span style=color:#abb2bf>          </span><span style=color:#eb6772>out </span><span style=color:#adb7c9>+= </span><span style=color:#9acc76>'&amp#9839;'</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>      }
</span><span style=color:#abb2bf>      </span><span style=color:#cd74e8>return </span><span style=color:#eb6772>out</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>    },
</span><span style=color:#abb2bf>    </span><span style=color:#eb6772>themaRegium</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>
</span><span style=color:#5f697a;font-style:italic>// "Thema Regium" beat by Bach feat. Frederich II of Prussia
</span><span style=color:#5f697a;font-style:italic>// note octave duration note octave duration ...
</span><span style=color:#eb6772>themaRegium </span><span style=color:#adb7c9>= 
</span><span style=color:#abb2bf>  </span><span style=color:#9acc76>'c  1   2  eb 1  2   g  1  2   ab 1 2    b  0.5 2  -- 1 1  g  1 1 ' </span><span style=color:#adb7c9>+
</span><span style=color:#abb2bf>  </span><span style=color:#9acc76>'f# 1   2  f  1  2   e  1  2   eb 1 3    d  1   1  db 1 1  c  1 1 ' </span><span style=color:#adb7c9>+
</span><span style=color:#abb2bf>  </span><span style=color:#9acc76>'b  .5  1  a  .5 .5  g  .5 .5  c  1 1    f  1   1  eb 1 2  d  1 2 ' </span><span style=color:#adb7c9>+
</span><span style=color:#abb2bf>  </span><span style=color:#9acc76>'c 1 4'</span><span style=color:#abb2bf>;
</span><span style=color:#eb6772>themaRegium </span><span style=color:#adb7c9>= </span><span style=color:#eb6772>themaRegium</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>split</span><span style=color:#abb2bf>(</span><span style=color:#5ebfcc>/</span><span style=color:#db9d63>\s</span><span style=color:#adb7c9>+</span><span style=color:#5ebfcc>/</span><span style=color:#cd74e8>g</span><span style=color:#abb2bf>);
</span><span style=color:#abb2bf>
</span><span style=color:#abb2bf>
</span><span style=color:#cd74e8>var </span><span style=color:#5cb3fa>nextNote </span><span style=color:#adb7c9>= </span><span style=color:#cd74e8>function</span><span style=color:#abb2bf>() {
</span><span style=color:#abb2bf>  </span><span style=color:#cd74e8>if</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>themaRegium</span><span style=color:#abb2bf>.length </span><span style=color:#adb7c9>< </span><span style=color:#db9d63>1</span><span style=color:#abb2bf>) {
</span><span style=color:#abb2bf>    document.body.</span><span style=color:#eb6772>innerHTML </span><span style=color:#adb7c9>+= </span><span style=color:#9acc76>'!'</span><span style=color:#abb2bf>; 
</span><span style=color:#abb2bf>    </span><span style=color:#cd74e8>return </span><span style=color:#eb6772>osc</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>stop</span><span style=color:#abb2bf>(); 
</span><span style=color:#abb2bf>  }
</span><span style=color:#abb2bf>
</span><span style=color:#abb2bf>  </span><span style=color:#cd74e8>var </span><span style=color:#eb6772>note </span><span style=color:#adb7c9>= </span><span style=color:#eb6772>themaRegium</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>shift</span><span style=color:#abb2bf>(),
</span><span style=color:#abb2bf>      </span><span style=color:#eb6772>oct  </span><span style=color:#adb7c9>= </span><span style=color:#5ebfcc>parseFloat</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>themaRegium</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>shift</span><span style=color:#abb2bf>()),
</span><span style=color:#abb2bf>      </span><span style=color:#eb6772>dur  </span><span style=color:#adb7c9>= </span><span style=color:#5ebfcc>parseFloat</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>themaRegium</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>shift</span><span style=color:#abb2bf>()) </span><span style=color:#adb7c9>* </span><span style=color:#db9d63>250</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>      </span><span style=color:#f0c678>console</span><span style=color:#abb2bf>.</span><span style=color:#5ebfcc>log</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>note</span><span style=color:#abb2bf>, </span><span style=color:#eb6772>dur</span><span style=color:#abb2bf>);
</span><span style=color:#abb2bf>
</span><span style=color:#abb2bf>  </span><span style=color:#eb6772>osc</span><span style=color:#abb2bf>.</span><span style=color:#eb6772>frequency</span><span style=color:#abb2bf>.value </span><span style=color:#adb7c9>= </span><span style=color:#eb6772>notes</span><span style=color:#abb2bf>[</span><span style=color:#eb6772>note</span><span style=color:#abb2bf>] </span><span style=color:#adb7c9>* </span><span style=color:#eb6772>oct</span><span style=color:#abb2bf>;
</span><span style=color:#abb2bf>  </span><span style=color:#5ebfcc>setTimeout</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>nextNote</span><span style=color:#abb2bf>, </span><span style=color:#eb6772>dur</span><span style=color:#abb2bf>);
</span><span style=color:#abb2bf>  document.body.</span><span style=color:#eb6772>innerHTML </span><span style=color:#adb7c9>+= </span><span style=color:#9acc76>' ' </span><span style=color:#adb7c9>+ </span><span style=color:#5cb3fa>toPrint</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>note</span><span style=color:#abb2bf>);
</span><span style=color:#abb2bf>}
</span><span style=color:#abb2bf>
</span><span style=color:#eb6772>osc</span><span style=color:#abb2bf>.</span><span style=color:#5cb3fa>connect</span><span style=color:#abb2bf>(</span><span style=color:#eb6772>ac</span><span style=color:#abb2bf>.</span><span style=color:#eb6772>destination</span><span style=color:#abb2bf>);
</span><span style=color:#eb6772>osc</span><span style=color:#abb2bf>.type </span><span style=color:#adb7c9>= </span><span style=color:#9acc76>'triangle'</span><span style=color:#abb2bf>;
</span><span style=color:#eb6772>osc</span><span style=color:#abb2bf>.</span><span style=color:#5cb3fa>start</span><span style=color:#abb2bf>(</span><span style=color:#db9d63>0</span><span style=color:#abb2bf>);
</span><span style=color:#5cb3fa>nextNote</span><span style=color:#abb2bf>();
</span></code></pre><p>Basically it's a crude regular language in which all <script type=math/tex>i \% 3</script> th tokens represent a note, all <script type=math/tex>i \% 3 + 1</script> th tokens represent the octave (expressed in a power of 2: e.g. lower octave is <script type=math/tex>\frac{1}{2}</script> , upper octave is <script type=math/tex>2</script> , next one is <script type=math/tex>4</script> und so weiter) and all <script type=math/tex>i \% 3 + 2</script> tokens represent the duration. The <code>nextNote</code> function is a finite state automaton that picks three values, translates it to a frequency, plugs it in the oscillator, then waits for <code>dur * 250</code> ms and moves on.<p>You can read the full code <a href=https://gist.github.com/veeenu/af48a4834ebc33306412>here</a> and listen to it in action <a href=http://bl.ocks.org/veeenu/af48a4834ebc33306412>here</a>.<p>I'd love to hear from you; what's your stance in the "man vs machine in music" discourse?</section></article><ul class=links><li><a href=https://github.com/veeenu target=_blank> <img alt=GitHub src=/img/github.svg> </a><li><a href=https://www.linkedin.com/in/andreavenuta/ target=_blank> <img alt=LinkedIn src=/img/linkedin.svg> </a><li><a href=https://twitter.com/johndisandonato target=_blank> <img alt=Twitter src=/img/twitter.svg> </a><li><a href=https://twitch.tv/johndisandonato target=_blank> <img alt=Twitch.tv src=/img/twitch.svg> </a><li><a href=cv.pdf target=_blank> <img alt="CV - Icon made by Vitaly Gorbachev (https://www.flaticon.com/authors/vitaly-gorbachev) from www.flaticon.com" src=/img/cv.svg> </a></ul></div><script async src=/katex.min.js></script><script data-cf-beacon='{"token": "9c82a3cc7db742e4bb18aebd57b40893"}' defer src=https://static.cloudflareinsights.com/beacon.min.js></script>